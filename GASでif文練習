import tkinter as tk
from tkinter import filedialog
import openpyxl
import os

def select_and_validate_file():
    root = tk.Tk()
    root.withdraw()  # メインウィンドウを非表示にする

    initial_dir = "C:/Users/YourUsername/Desktop"  # 初期ディレクトリを設定
    while True:
        file_path = filedialog.askopenfilename(
            initialdir=initial_dir,
            title="Excelファイルを選択してください",
            filetypes=[("Excel files", "*.xlsx")]
        )
        
        if not file_path:  # ユーザーがキャンセルした場合
            print("ファイル選択がキャンセルされました。")
            return None
        
        file_name = os.path.basename(file_path)
        
        if "ああああ" not in file_name:
            print("ファイル名が違います。'ああああ'を含むファイルを選択してください。")
            continue
        
        try:
            workbook = openpyxl.load_workbook(file_path)
            
            if "いいいい" not in workbook.sheetnames:
                print("'いいいい'という名前のシートが見つかりません。処理を中断します。")
                return None
            
            sheet = workbook["いいいい"]
            headers = [cell.value for cell in sheet[1]]
            
            if "うううう" not in headers or "ええええ" not in headers:
                print("ヘッダーに'うううう'と'ええええ'が両方含まれていません。処理を中断します。")
                return None
            
            print(f"ファイル '{file_name}' が正常に検証されました。")
            return file_path
        
        except Exception as e:
            print(f"ファイルの読み込み中にエラーが発生しました: {e}")
            continue

# メイン処理
selected_file = select_and_validate_file()
if selected_file:
    print(f"選択されたファイル: {selected_file}")
else:
    print("有効なファイルが選択されませんでした。")
