function applyConditionalFormatting() {
  const sheet = SpreadsheetApp.getActiveSpreadsheet().getActiveSheet();
  const dataRange = sheet.getDataRange();
  const values = dataRange.getValues();
  const backgrounds = dataRange.getBackgrounds();

  // ヘッダー行からカラムのインデックスを取得
  const headers = values[0];
  const endColumnIndex = headers.indexOf('終了');
  const confirmDateColumnIndex = headers.indexOf('確認予定');
  const limitColumnIndex = headers.indexOf('リミット');
  const checkColumnIndex = headers.indexOf('チェック');
  const prevMonthColumnIndex = headers.indexOf('前月確認');

  // 条件に基づいて背景色を設定
  for (let i = 1; i < values.length; i++) {
    const row = values[i];
    
    if (row[endColumnIndex] !== '') {
      // [終了]に値がある場合、行全体を灰色に
      for (let j = 0; j < row.length; j++) {
        backgrounds[i][j] = '#D3D3D3'; // 灰色
      }
    } else if (row[limitColumnIndex] !== '' && row[confirmDateColumnIndex] === '') {
      // [リミット]に値があり[確認予定]がない場合、指定の列をオレンジに
      backgrounds[i][limitColumnIndex] = '#FFA500'; // オレンジ
      backgrounds[i][checkColumnIndex] = '#FFA500';
      backgrounds[i][prevMonthColumnIndex] = '#FFA500';
    } else if (row[limitColumnIndex] !== '' && row[confirmDateColumnIndex] !== '') {
      // [リミット]と[確認予定]の日付を比較
      const limitDate = new Date(row[limitColumnIndex]);
      const confirmDate = new Date(row[confirmDateColumnIndex]);
      
      if (limitDate < confirmDate) {
        // [リミット] < [確認予定]の場合、指定の列を黄色に
        backgrounds[i][limitColumnIndex] = '#FFFF00'; // 黄色
        backgrounds[i][checkColumnIndex] = '#FFFF00';
        backgrounds[i][prevMonthColumnIndex] = '#FFFF00';
      }
    }
  }

  // 一括で背景色を適用
  dataRange.setBackgrounds(backgrounds);
}
